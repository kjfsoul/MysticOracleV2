import{r as g,j as e,s as k,u as U,an as O,C as I,a as T,b as P,e as F,v as R,B as x,at as B,A as Y,f as z}from"./index-B2YqtOc4.js";import{g as A}from"./tarot-deck-config-CUtchsZt.js";import{C as E}from"./calendar-3uPonnul.js";const J=async(t,a)=>{console.log(`Feedback received: ${t}`,a?`for user ${a}`:"(anonymous)");try{const r=JSON.parse(sessionStorage.getItem("mystic_feedback")||"[]");r.push({date:new Date().toISOString().split("T")[0],choice:t}),sessionStorage.setItem("mystic_feedback",JSON.stringify(r))}catch(r){console.warn("Could not save feedback to session storage:",r)}await new Promise(r=>setTimeout(r,100))};function M(t){var u,d;if(!t)return console.warn("getTarotCardImagePath called with null card, returning placeholder."),"/images/tarot/placeholders/card-back.svg";if(t.imagePath&&t.imagePath.trim()!=="")return t.imagePath;const a=A();if(!a)return console.error("No active tarot deck found! Using default placeholder."),"/images/tarot/placeholders/card-back.svg";const r=((u=t.arcana)==null?void 0:u.toLowerCase())||"unknown",l=a.imageFormat||"jpg";let n=t.id||"unknown-id";if(n==="07-chariot"||n==="13-death"||n==="16-tower")return console.warn(`Using placeholder for known problematic card: ${n}`),"/images/tarot/placeholders/major-placeholder.svg";if(a.cardPathTemplate)return a.cardPathTemplate.replace("{arcana}",r).replace("{suit}",((d=t.suit)==null?void 0:d.toLowerCase())||"none").replace("{id}",n);const c=r==="minor"&&t.suit?`/${t.suit.toLowerCase()}`:"";return`/images/tarot/decks/${a.id}/${r}${c}/${n}.${l}`}function H(){const t=A();return(t==null?void 0:t.cardBackImage)||"/images/tarot/placeholders/card-back.svg"}function q(t,a,r){console.warn(`Image failed to load: ${a}`);let l="/images/tarot/placeholders/card-back.svg";t&&(t.arcana==="major"?l="/images/tarot/placeholders/major-placeholder.svg":t.arcana==="minor"&&t.suit&&(l=`/images/tarot/placeholders/${t.suit.toLowerCase()}-placeholder.svg`)),console.log(`Using fallback image: ${l}`),r(l)}const L=t=>{var p;if(!t)return console.warn("getSimpleTarotCardImagePath called with null card, returning placeholder."),"/images/tarot/placeholders/card-back.svg";if(t.id==="07-chariot"||t.id==="13-death"||t.id==="16-tower")return console.warn(`Using placeholder for known problematic card: ${t.id}`),"/images/tarot/placeholders/major-placeholder.svg";const a=A(),l=(t.card_id||t.id||t.name.toLowerCase().replace(/\s+/g,"-")).replace(/-of-/g,"-"),n=((p=t.arcana)==null?void 0:p.toLowerCase())||"unknown",c=t.suit?t.suit.toLowerCase():null;return a.cardPathTemplate?a.cardPathTemplate.replace("{arcana}",n).replace("{suit}",c||"none").replace("{id}",l):n==="major"?`/images/tarot/decks/${a.id}/major/${l}.${a.imageFormat||"jpg"}`:n==="minor"&&c?`/images/tarot/decks/${a.id}/minor/${c}/${l}.${a.imageFormat||"jpg"}`:a.cardBackImage||`/images/tarot/decks/${a.id}/card-back.${a.imageFormat||"jpg"}`},G={sm:{width:100,height:170},md:{width:140,height:240},lg:{width:180,height:300},xl:{width:220,height:370}},_=({card:t,isReversed:a=!1,size:r="md",autoReveal:l=!1,revealDelay:n=1500,onClick:c,className:p="",showMeaning:u=!1,imagePath:d})=>{const[h,f]=g.useState(l),[w,b]=g.useState(!1),[v,N]=g.useState(null),[C,D]=g.useState(""),{width:y,height:$}=G[r];g.useEffect(()=>{const i=d||M(t);console.log(`Loading image for ${t.name} from ${d?"provided":"generated"} path: ${i}`);const o=new Image;o.src=i,o.onload=()=>{console.log(`Successfully loaded image: ${i}`),N(i),b(!0)},o.onerror=()=>{console.error(`Failed to load image: ${i}`),q(t,i,N),b(!0)}},[t,d]),g.useEffect(()=>{let i=null;return l&&!h&&(console.log(`Setting up auto-reveal timer for card: ${t.name}`),i=setTimeout(()=>{console.log(`Auto-revealing card via timer: ${t.name}`),f(!0)},n)),()=>{i&&(console.log(`Clearing auto-reveal timer for card: ${t.name}`),clearTimeout(i))}},[l,n,t.name,h]);const S=i=>{f(o=>!o),c&&c(i)},s=()=>{switch(C){case"glow":return"animate-glow";case"sparkle":return"animate-sparkle";case"jump":return"animate-jump";case"pulse":return"animate-pulse-card";case"rotate":return"animate-rotate";default:return""}};return e.jsx("div",{className:`relative perspective-1000 cursor-pointer ${p}`,style:{width:y,height:$},onClick:S,children:e.jsxs(k.div,{className:"w-full h-full relative preserve-3d transition-transform duration-700",animate:{rotateY:h?180:0},transition:{duration:.7,ease:[.4,0,.2,1]},children:[e.jsx("div",{className:"absolute w-full h-full backface-hidden rounded-lg shadow-lg border border-gold/30 overflow-hidden",style:{backgroundImage:`url(${H()})`,backgroundSize:"cover",backgroundPosition:"center"}}),e.jsx("div",{className:"absolute w-full h-full backface-hidden rounded-lg shadow-lg border border-gold/30 overflow-hidden",style:{transform:"rotateY(180deg)"},children:w?e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("div",{className:`tarot-card-front ${h?s():""}`,children:e.jsx("img",{className:"w-full h-full object-contain",src:v||"",alt:t.name,style:{transform:a?"rotate(180deg)":"rotate(0deg)"}})}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-dark/80 backdrop-blur-sm p-2 text-center",children:[e.jsx("h3",{className:"text-gold font-heading text-sm md:text-base truncate",children:t.name}),u&&e.jsx("p",{className:"text-light/80 text-xs mt-1 line-clamp-2",children:a?t.meaningReversed:t.meaningUpright})]}),a&&e.jsx("div",{className:"absolute top-2 right-2 bg-warning/80 text-dark text-xs px-1.5 py-0.5 rounded-sm font-medium",children:"Reversed"})]}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-primary-20",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-gold rounded-full border-t-transparent"})})})]})})},Z=({onViewFullReading:t,className:a=""})=>{const[r,l]=g.useState(!1),[n,c]=g.useState(!1),[p,u]=g.useState(!1),{user:d}=U(),h=d==null?void 0:d.id,f=new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),{data:w,isLoading:b,error:v,isError:N,refetch:C}=O({queryKey:["dailyCard",h,f],queryFn:async()=>{console.log(`Fetching daily card for userId: ${h}`);const o=await fetch(`/api/tarot-cards/card-of-the-day?userId=${h||""}`);if(!o.ok){const m=await o.text();throw console.error(`API Error (${o.status}): ${m}`),new Error(`Failed to fetch daily card: ${o.statusText} - ${m.substring(0,100)}`)}const j=o.headers.get("content-type");if(j&&j.includes("application/json")){const m=await o.json();if(!m||!m.card)throw console.error("Invalid JSON structure received:",m),new Error("Received invalid data structure from API.");return console.log("Successfully fetched daily card data:",m),m}else{const m=await o.text();throw console.error("Received non-JSON response:",m.substring(0,200)),new Error("Received unexpected response format from server. Check authentication or API endpoint.")}},staleTime:1e3*60*60*12,gcTime:1e3*60*60*24,refetchOnWindowFocus:!1,refetchOnMount:!0,retry:1});g.useEffect(()=>{l(!1),u(!1)},[w]);const D=()=>{r||l(!0)},y=async o=>{try{await J(o,h),c(!0),setTimeout(()=>c(!1),1500)}catch(j){console.error("Failed to save feedback:",j)}},$=()=>u(!0),S=()=>u(!1);if(b)return e.jsxs(I,{className:`w-full max-w-md mx-auto border border-gold/20 bg-primary-10/50 ${a}`,children:[e.jsxs(T,{children:[e.jsx(P,{className:"text-center text-gold/80 animate-pulse",children:"Your Daily Tarot"}),e.jsx("div",{className:"text-sm text-muted-foreground text-center animate-pulse",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-light/50",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx("span",{children:f})]})})]}),e.jsxs(F,{className:"flex flex-col items-center py-10",children:[e.jsx("div",{className:"w-64 h-96 bg-gradient-to-br from-indigo-700/30 to-purple-900/30 rounded-lg animate-pulse flex items-center justify-center",children:e.jsx(R,{className:"w-12 h-12 text-gold/30 animate-spin slow-spin"})}),e.jsx("p",{className:"text-sm text-center mt-4 text-light/70 animate-pulse",children:"The mystical energies are aligning..."})]})]});if(N||!w)return console.error("Error state triggered for Daily Card. Error:",v),e.jsxs(I,{className:`w-full max-w-md mx-auto border border-destructive/30 bg-primary-10/50 ${a}`,children:[e.jsxs(T,{children:[e.jsx(P,{className:"text-center text-destructive",children:"Unable to Reveal Your Card"}),e.jsx("div",{className:"text-sm text-muted-foreground text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-light/70",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx("span",{children:f})]})})]}),e.jsx(F,{className:"flex flex-col items-center py-6",children:e.jsx("div",{className:"w-64 h-96 bg-primary-20/50 rounded-lg flex items-center justify-center relative overflow-hidden border border-destructive/20",children:e.jsxs("div",{className:"p-6 text-center flex flex-col items-center",children:[e.jsx("p",{className:"text-light/80 mb-4",children:(v==null?void 0:v.message)||"The mystical energies are temporarily disrupted. Please try again later."}),e.jsx("div",{className:"mt-4",children:e.jsxs(x,{variant:"outline",onClick:()=>C(),className:"border-destructive/50 text-destructive hover:bg-destructive/10",children:[e.jsx(B,{className:"h-4 w-4 mr-2"})," Try Again"]})})]})})})]});const{card:s,isReversed:i}=w;return console.log("Card data received:",s),e.jsx(Y,{mode:"wait",children:p?e.jsx(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:a,children:e.jsxs(I,{className:"w-full max-w-4xl mx-auto bg-primary-10 border-gold/30",children:[e.jsx(T,{children:e.jsx(P,{className:"text-center mt-2 text-gold",children:s.name})}),e.jsx(F,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(_,{card:s,isReversed:i,size:"xl",autoReveal:!0,imagePath:L(s)})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gold mb-2",children:i?"Reversed Meaning":"Upright Meaning"}),e.jsx("p",{className:"text-light/90",children:i?s.reversed_meaning||s.meaningReversed:s.upright_meaning||s.meaningUpright}),s.keywords&&s.keywords.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gold mb-2",children:"Keywords"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.keywords.map((o,j)=>e.jsx("span",{className:"bg-primary-20 px-2 py-1 rounded text-sm text-light/90",children:o},j))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[(s.element||s.elemental_association)&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gold mb-1",children:"Element"}),e.jsx("p",{className:"text-light/90",children:s.element||s.elemental_association})]}),(s.zodiacSign||s.astrological_association)&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gold mb-1",children:"Zodiac"}),e.jsx("p",{className:"text-light/90",children:s.zodiacSign||s.astrological_association})]})]})]})]})}),e.jsxs(z,{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsx(x,{variant:"outline",onClick:S,className:"border-gold/50 text-gold",children:"Back to Card"}),t&&e.jsxs(x,{onClick:t,className:"bg-gold/20 hover:bg-gold/30 text-gold border border-gold/50",children:[e.jsx(R,{className:"mr-2 h-4 w-4"}),"Get Full Reading"]})]})]})},"details"):e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:a,children:e.jsxs("section",{className:"relative text-center py-10 px-4 md:px-6",children:[e.jsx("h2",{className:"text-3xl md:text-5xl font-serif text-gold mb-8",children:"Today's Cosmic Guidance"}),e.jsx("div",{className:"relative w-64 h-96 mx-auto mb-8 cursor-pointer perspective-1000",onClick:D,children:e.jsx(_,{card:s,isReversed:i,size:"lg",autoReveal:r,imagePath:L(s)})}),!r&&e.jsx("p",{className:"text-sm text-center mb-12 text-light/80 animate-pulse",children:"Tap the card to reveal your guidance..."}),e.jsxs("div",{className:"mt-12 relative",children:[" ",e.jsx("h3",{className:"text-2xl text-white mb-4 font-serif",children:"Unlock Your Mystical Journey — Sign Up Free!"}),e.jsx(x,{asChild:!0,className:"relative inline-block bg-yellow-500 hover:bg-yellow-400 text-black font-bold py-3 px-8 rounded-full shadow-lg transition transform hover:scale-105",children:e.jsxs("a",{href:"/signup",children:[" ","Create My Free Account",n&&e.jsx("div",{className:"absolute -top-2 -right-2 w-8 h-8 bg-yellow-300 rounded-full opacity-70 animate-sparkle pointer-events-none",style:{filter:"blur(4px)"}})]})})]}),r&&e.jsxs(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5,duration:.5},className:"mt-16 p-6 bg-gradient-to-r from-purple-800/70 via-indigo-800/70 to-black/70 rounded-lg shadow-lg max-w-md mx-auto backdrop-blur-sm",children:[e.jsx("h3",{className:"text-xl font-serif text-white mb-4",children:"How aligned did today's card feel?"}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center gap-3",children:[e.jsx(x,{onClick:()=>y("deeply_resonated"),variant:"outline",className:"border-yellow-400 text-yellow-400 hover:bg-yellow-400/10 flex-1",children:"Deeply Resonated 🌟"}),e.jsx(x,{onClick:()=>y("somewhat_relevant"),variant:"outline",className:"border-gray-500 text-gray-300 hover:bg-gray-700/20 flex-1",children:"Somewhat Relevant 🌙"}),e.jsx(x,{onClick:()=>y("not_really"),variant:"outline",className:"border-gray-600 text-gray-400 hover:bg-gray-800/30 flex-1",children:"Not Really 🔮"})]}),e.jsx("p",{className:"mt-4 text-xs text-gray-400 italic",children:"Your insights shape a deeper connection for your next reading. ✨"})]}),r&&t&&e.jsx("div",{className:"mt-8",children:e.jsx(x,{variant:"outline",onClick:$,className:"border-gold/50 text-gold",children:"View Full Details"})})]})},"simple")})};export{_ as A,Z as D};
