import{u as b,r as o,j as e,C as A,a as y,b as L,d as S,e as T,L as l,t as d,B as c,f as D,ap as I}from"./index-B2YqtOc4.js";import{S as p}from"./separator-1s178J9z.js";function $(){const{user:n,isLoading:f,login:N}=b(),[m,w]=o.useState({}),[h,u]=o.useState(!1),[x,j]=o.useState(!1),v=async()=>{var g;u(!0);const t=["/api/user","/api/tarot-readings","/api/auth-test"],a={};for(const i of t)try{const s=await I(i);console.log(`Data from ${i}:`,s);let r="200 OK";i==="/api/auth-test"&&s.status&&(r+=` (${s.status})`),a[i]=r}catch(s){if((g=s==null?void 0:s.message)!=null&&g.includes("HTTP error")){const r=s.message.match(/(\d{3})/);r?a[i]=`${r[1]} Error`:a[i]=`Error: ${(s==null?void 0:s.message)||"Unknown error"}`}else a[i]=`Error: ${(s==null?void 0:s.message)||"Unknown error"}`}w(a),u(!1)},C=async()=>{try{j(!0),await N("newuser","password123")}catch(t){console.error("Login error:",(t==null?void 0:t.message)||"Unknown error")}finally{j(!1)}},k=()=>document.cookie?"Cookies present: "+document.cookie:"No cookies found";return e.jsx("div",{className:"container mx-auto p-4 max-w-3xl",children:e.jsxs(A,{className:"mb-8",children:[e.jsxs(y,{children:[e.jsx(L,{children:"Authentication Debug"}),e.jsx(S,{children:"Use this tool to diagnose authentication issues"})]}),e.jsx(T,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"Current Authentication Status"}),f?e.jsxs("div",{className:"flex items-center mt-2",children:[e.jsx(l,{className:"h-4 w-4 mr-2 animate-spin"}),e.jsx("span",{children:"Checking authentication..."})]}):e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:["Status:",n?e.jsx(d,{className:"bg-green-500",children:"Authenticated"}):e.jsx(d,{variant:"destructive",children:"Not Authenticated"})]}),n&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("p",{children:["Username: ",n.username]}),e.jsxs("p",{children:["Email: ",n.email]}),e.jsxs("p",{children:["User ID: ",n.id]})]})]})]}),e.jsx(p,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"Cookie Information"}),e.jsx("pre",{className:"mt-2 bg-card-muted p-2 rounded text-sm",children:k()})]}),e.jsx(p,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"API Authentication Tests"}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{children:[e.jsx("a",{href:"/api/direct-login-test",className:"text-blue-500 underline hover:text-blue-700",onClick:t=>{t.preventDefault(),window.location.href="/api/direct-login-test"},children:"Direct Login via Browser"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"This will perform a direct login and then return to this page to test if cookies were set correctly."})]}),e.jsxs(c,{onClick:v,disabled:h,variant:"outline",children:[h&&e.jsx(l,{className:"mr-2 h-4 w-4 animate-spin"}),"Test API Authentication"]}),Object.keys(m).length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-medium",children:"Results:"}),e.jsx("ul",{className:"space-y-2 mt-2",children:Object.entries(m).map(([t,a])=>e.jsxs("li",{className:"flex flex-col",children:[e.jsxs("span",{className:"font-mono text-sm",children:[t,": "]}),e.jsx(d,{className:`w-fit mt-1 ${a.startsWith("2")?"bg-green-500":"bg-red-500"}`,children:a})]},t))})]})]})]})]})}),e.jsxs(D,{className:"flex justify-between",children:[e.jsx(c,{variant:"outline",onClick:()=>window.location.href="/auth",children:"Go to Login Page"}),e.jsx(c,{variant:"outline",onClick:()=>window.open("/api/direct-login-test","_blank"),children:"Try Server Direct Login"}),e.jsxs(c,{onClick:C,disabled:x,children:[x&&e.jsx(l,{className:"mr-2 h-4 w-4 animate-spin"}),"Test Direct Login"]})]})]})})}export{$ as default};
