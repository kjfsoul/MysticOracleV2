import{r as h,j as e,s as k,u as U,an as O,C as I,a as T,b as P,e as F,v as D,B as f,at as B,A as J,f as M}from"./index-C07lX9-t.js";import{g as A}from"./tarot-deck-config-CUtchsZt.js";import{C as R}from"./calendar-rUhL_-1H.js";const Y=async(t,a)=>{console.log(`Feedback received: ${t}`,a?`for user ${a}`:"(anonymous)");try{const r=JSON.parse(sessionStorage.getItem("mystic_feedback")||"[]");r.push({date:new Date().toISOString().split("T")[0],choice:t}),sessionStorage.setItem("mystic_feedback",JSON.stringify(r))}catch(r){console.warn("Could not save feedback to session storage:",r)}await new Promise(r=>setTimeout(r,100))};function z(t){var u,x;if(!t)return console.warn("getTarotCardImagePath called with null card, returning placeholder."),"/images/tarot/placeholders/card-back.svg";if(t.imagePath&&t.imagePath.trim()!=="")return t.imagePath;const a=A();if(!a)return console.error("No active tarot deck found! Using default placeholder."),"/images/tarot/placeholders/card-back.svg";const r=((u=t.arcana)==null?void 0:u.toLowerCase())||"major",i=a.imageFormat||"jpg";let s="";if(r==="major"){const m={fool:"00-fool",magician:"01-magician","high-priestess":"02-high-priestess",empress:"03-empress",emperor:"04-emperor",hierophant:"05-hierophant",lovers:"06-lovers",chariot:"07-chariot",strength:"08-strength",hermit:"09-hermit","wheel-of-fortune":"10-wheel-of-fortune",justice:"11-justice","hanged-man":"12-hanged-man",death:"13-death",temperance:"14-temperance",devil:"15-devil",tower:"16-tower",star:"17-star",moon:"18-moon",sun:"19-sun",judgement:"20-judgement",world:"21-world"};if(t.id&&t.id.includes("-"))s=t.id;else if(t.number!==void 0&&t.name){const c=t.number.toString().padStart(2,"0"),p=t.name.toLowerCase().replace(/\s+/g,"-");s=`${c}-${p}`}else if(t.name){const c=t.name.toLowerCase().replace(/\s+/g,"-");s=m[c]||`00-${c}`}else s=t.id||"unknown-card"}else if(r==="minor"&&t.suit){const m=t.suit.toLowerCase(),c=t.name.split(" ")[0].toLowerCase();t.id&&t.id.includes("-")?s=t.id:s=`${c}-${m}`}else s=t.id||"unknown-card";if(s==="07-chariot"||s==="13-death"||s==="16-tower"||s==="chariot"||s==="death"||s==="tower")return console.warn(`Using placeholder for known problematic card: ${s}`),"/images/tarot/placeholders/major-placeholder.svg";if(a.cardPathTemplate)return a.cardPathTemplate.replace("{arcana}",r).replace("{suit}",((x=t.suit)==null?void 0:x.toLowerCase())||"none").replace("{id}",s);let d="";if(r==="major")d=`/images/tarot/decks/${a.id}/major/${s}.${i}`;else if(r==="minor"&&t.suit){const m=t.suit.toLowerCase();d=`/images/tarot/decks/${a.id}/minor/${m}/${s}.${i}`}else console.warn(`Cannot determine proper path for card: ${JSON.stringify(t)}`),d=a.cardBackImage||"/images/tarot/placeholders/card-back.svg";return console.log(`Generated image path for ${t.name||"unknown card"}: ${d}`),d}function G(){const t=A();return(t==null?void 0:t.cardBackImage)||"/images/tarot/placeholders/card-back.svg"}function H(t,a,r){console.warn(`Image failed to load: ${a}`);let i="/images/tarot/placeholders/card-back.svg";t&&(t.arcana==="major"?i="/images/tarot/placeholders/major-placeholder.svg":t.arcana==="minor"&&t.suit&&(i=`/images/tarot/placeholders/${t.suit.toLowerCase()}-placeholder.svg`)),console.log(`Using fallback image: ${i}`),r(i)}const E=t=>{var u;if(!t)return console.warn("getSimpleTarotCardImagePath called with null card, returning placeholder."),"/images/tarot/placeholders/card-back.svg";if(t.id==="07-chariot"||t.id==="13-death"||t.id==="16-tower")return console.warn(`Using placeholder for known problematic card: ${t.id}`),"/images/tarot/placeholders/major-placeholder.svg";const a=A(),i=(t.card_id||t.id||t.name.toLowerCase().replace(/\s+/g,"-")).replace(/-of-/g,"-"),s=((u=t.arcana)==null?void 0:u.toLowerCase())||"unknown",d=t.suit?t.suit.toLowerCase():null;return a.cardPathTemplate?a.cardPathTemplate.replace("{arcana}",s).replace("{suit}",d||"none").replace("{id}",i):s==="major"?`/images/tarot/decks/${a.id}/major/${i}.${a.imageFormat||"jpg"}`:s==="minor"&&d?`/images/tarot/decks/${a.id}/minor/${d}/${i}.${a.imageFormat||"jpg"}`:a.cardBackImage||`/images/tarot/decks/${a.id}/card-back.${a.imageFormat||"jpg"}`},q={sm:{width:100,height:170},md:{width:140,height:240},lg:{width:180,height:300},xl:{width:220,height:370}},_=({card:t,isReversed:a=!1,size:r="md",autoReveal:i=!1,revealDelay:s=1500,onClick:d,className:u="",showMeaning:x=!1,imagePath:m})=>{const[c,p]=h.useState(i),[w,b]=h.useState(!1),[v,N]=h.useState(null),[C,L]=h.useState(""),{width:y,height:$}=q[r];h.useEffect(()=>{const l=m||z(t);console.log(`Loading image for ${t.name} from ${m?"provided":"generated"} path: ${l}`);const n=new Image;n.src=l,n.onload=()=>{console.log(`Successfully loaded image: ${l}`),N(l),b(!0)},n.onerror=()=>{console.error(`Failed to load image: ${l}`),H(t,l,N),b(!0)}},[t,m]),h.useEffect(()=>{let l=null;return i&&!c&&(console.log(`Setting up auto-reveal timer for card: ${t.name}`),l=setTimeout(()=>{console.log(`Auto-revealing card via timer: ${t.name}`),p(!0)},s)),()=>{l&&(console.log(`Clearing auto-reveal timer for card: ${t.name}`),clearTimeout(l))}},[i,s,t.name,c]);const S=l=>{p(n=>!n),d&&d(l)},o=()=>{switch(C){case"glow":return"animate-glow";case"sparkle":return"animate-sparkle";case"jump":return"animate-jump";case"pulse":return"animate-pulse-card";case"rotate":return"animate-rotate";default:return""}};return e.jsx("div",{className:`relative perspective-1000 cursor-pointer ${u}`,style:{width:y,height:$},onClick:S,children:e.jsxs(k.div,{className:"w-full h-full relative preserve-3d transition-transform duration-700",animate:{rotateY:c?180:0},transition:{duration:.7,ease:[.4,0,.2,1]},children:[e.jsx("div",{className:"absolute w-full h-full backface-hidden rounded-lg shadow-lg border border-gold/30 overflow-hidden",style:{backgroundImage:`url(${G()})`,backgroundSize:"cover",backgroundPosition:"center"}}),e.jsx("div",{className:"absolute w-full h-full backface-hidden rounded-lg shadow-lg border border-gold/30 overflow-hidden",style:{transform:"rotateY(180deg)"},children:w?e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("div",{className:`tarot-card-front ${c?o():""}`,children:e.jsx("img",{className:"w-full h-full object-contain",src:v||"",alt:t.name,style:{transform:a?"rotate(180deg)":"rotate(0deg)"}})}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-dark/80 backdrop-blur-sm p-2 text-center",children:[e.jsx("h3",{className:"text-gold font-heading text-sm md:text-base truncate",children:t.name}),x&&e.jsx("p",{className:"text-light/80 text-xs mt-1 line-clamp-2",children:a?t.meaningReversed:t.meaningUpright})]}),a&&e.jsx("div",{className:"absolute top-2 right-2 bg-warning/80 text-dark text-xs px-1.5 py-0.5 rounded-sm font-medium",children:"Reversed"})]}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-primary-20",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-gold rounded-full border-t-transparent"})})})]})})},Z=({onViewFullReading:t,className:a=""})=>{const[r,i]=h.useState(!1),[s,d]=h.useState(!1),[u,x]=h.useState(!1),{user:m}=U(),c=m==null?void 0:m.id,p=new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),{data:w,isLoading:b,error:v,isError:N,refetch:C}=O({queryKey:["dailyCard",c,p],queryFn:async()=>{console.log(`Fetching daily card for userId: ${c}`);const n=await fetch(`/api/tarot-cards/card-of-the-day?userId=${c||""}`);if(!n.ok){const g=await n.text();throw console.error(`API Error (${n.status}): ${g}`),new Error(`Failed to fetch daily card: ${n.statusText} - ${g.substring(0,100)}`)}const j=n.headers.get("content-type");if(j&&j.includes("application/json")){const g=await n.json();if(!g||!g.card)throw console.error("Invalid JSON structure received:",g),new Error("Received invalid data structure from API.");return console.log("Successfully fetched daily card data:",g),g}else{const g=await n.text();throw console.error("Received non-JSON response:",g.substring(0,200)),new Error("Received unexpected response format from server. Check authentication or API endpoint.")}},staleTime:1e3*60*60*12,gcTime:1e3*60*60*24,refetchOnWindowFocus:!1,refetchOnMount:!0,retry:1});h.useEffect(()=>{i(!1),x(!1)},[w]);const L=()=>{r||i(!0)},y=async n=>{try{await Y(n,c),d(!0),setTimeout(()=>d(!1),1500)}catch(j){console.error("Failed to save feedback:",j)}},$=()=>x(!0),S=()=>x(!1);if(b)return e.jsxs(I,{className:`w-full max-w-md mx-auto border border-gold/20 bg-primary-10/50 ${a}`,children:[e.jsxs(T,{children:[e.jsx(P,{className:"text-center text-gold/80 animate-pulse",children:"Your Daily Tarot"}),e.jsx("div",{className:"text-sm text-muted-foreground text-center animate-pulse",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-light/50",children:[e.jsx(R,{className:"h-4 w-4"}),e.jsx("span",{children:p})]})})]}),e.jsxs(F,{className:"flex flex-col items-center py-10",children:[e.jsx("div",{className:"w-64 h-96 bg-gradient-to-br from-indigo-700/30 to-purple-900/30 rounded-lg animate-pulse flex items-center justify-center",children:e.jsx(D,{className:"w-12 h-12 text-gold/30 animate-spin slow-spin"})}),e.jsx("p",{className:"text-sm text-center mt-4 text-light/70 animate-pulse",children:"The mystical energies are aligning..."})]})]});if(N||!w)return console.error("Error state triggered for Daily Card. Error:",v),e.jsxs(I,{className:`w-full max-w-md mx-auto border border-destructive/30 bg-primary-10/50 ${a}`,children:[e.jsxs(T,{children:[e.jsx(P,{className:"text-center text-destructive",children:"Unable to Reveal Your Card"}),e.jsx("div",{className:"text-sm text-muted-foreground text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-light/70",children:[e.jsx(R,{className:"h-4 w-4"}),e.jsx("span",{children:p})]})})]}),e.jsx(F,{className:"flex flex-col items-center py-6",children:e.jsx("div",{className:"w-64 h-96 bg-primary-20/50 rounded-lg flex items-center justify-center relative overflow-hidden border border-destructive/20",children:e.jsxs("div",{className:"p-6 text-center flex flex-col items-center",children:[e.jsx("p",{className:"text-light/80 mb-4",children:(v==null?void 0:v.message)||"The mystical energies are temporarily disrupted. Please try again later."}),e.jsx("div",{className:"mt-4",children:e.jsxs(f,{variant:"outline",onClick:()=>C(),className:"border-destructive/50 text-destructive hover:bg-destructive/10",children:[e.jsx(B,{className:"h-4 w-4 mr-2"})," Try Again"]})})]})})})]});const{card:o,isReversed:l}=w;return console.log("Card data received:",o),e.jsx(J,{mode:"wait",children:u?e.jsx(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:a,children:e.jsxs(I,{className:"w-full max-w-4xl mx-auto bg-primary-10 border-gold/30",children:[e.jsx(T,{children:e.jsx(P,{className:"text-center mt-2 text-gold",children:o.name})}),e.jsx(F,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(_,{card:o,isReversed:l,size:"xl",autoReveal:!0,imagePath:E(o)})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gold mb-2",children:l?"Reversed Meaning":"Upright Meaning"}),e.jsx("p",{className:"text-light/90",children:l?o.reversed_meaning||o.meaningReversed:o.upright_meaning||o.meaningUpright}),o.keywords&&o.keywords.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gold mb-2",children:"Keywords"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:o.keywords.map((n,j)=>e.jsx("span",{className:"bg-primary-20 px-2 py-1 rounded text-sm text-light/90",children:n},j))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[(o.element||o.elemental_association)&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gold mb-1",children:"Element"}),e.jsx("p",{className:"text-light/90",children:o.element||o.elemental_association})]}),(o.zodiacSign||o.astrological_association)&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gold mb-1",children:"Zodiac"}),e.jsx("p",{className:"text-light/90",children:o.zodiacSign||o.astrological_association})]})]})]})]})}),e.jsxs(M,{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsx(f,{variant:"outline",onClick:S,className:"border-gold/50 text-gold",children:"Back to Card"}),t&&e.jsxs(f,{onClick:t,className:"bg-gold/20 hover:bg-gold/30 text-gold border border-gold/50",children:[e.jsx(D,{className:"mr-2 h-4 w-4"}),"Get Full Reading"]})]})]})},"details"):e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:a,children:e.jsxs("section",{className:"relative text-center py-10 px-4 md:px-6",children:[e.jsx("h2",{className:"text-3xl md:text-5xl font-serif text-gold mb-8",children:"Today's Cosmic Guidance"}),e.jsx("div",{className:"relative w-64 h-96 mx-auto mb-8 cursor-pointer perspective-1000",onClick:L,children:e.jsx(_,{card:o,isReversed:l,size:"lg",autoReveal:r,imagePath:E(o)})}),!r&&e.jsx("p",{className:"text-sm text-center mb-12 text-light/80 animate-pulse",children:"Tap the card to reveal your guidance..."}),e.jsxs("div",{className:"mt-12 relative",children:[" ",e.jsx("h3",{className:"text-2xl text-white mb-4 font-serif",children:"Unlock Your Mystical Journey â€” Sign Up Free!"}),e.jsx(f,{asChild:!0,className:"relative inline-block bg-yellow-500 hover:bg-yellow-400 text-black font-bold py-3 px-8 rounded-full shadow-lg transition transform hover:scale-105",children:e.jsxs("a",{href:"/signup",children:[" ","Create My Free Account",s&&e.jsx("div",{className:"absolute -top-2 -right-2 w-8 h-8 bg-yellow-300 rounded-full opacity-70 animate-sparkle pointer-events-none",style:{filter:"blur(4px)"}})]})})]}),r&&e.jsxs(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5,duration:.5},className:"mt-16 p-6 bg-gradient-to-r from-purple-800/70 via-indigo-800/70 to-black/70 rounded-lg shadow-lg max-w-md mx-auto backdrop-blur-sm",children:[e.jsx("h3",{className:"text-xl font-serif text-white mb-4",children:"How aligned did today's card feel?"}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center gap-3",children:[e.jsx(f,{onClick:()=>y("deeply_resonated"),variant:"outline",className:"border-yellow-400 text-yellow-400 hover:bg-yellow-400/10 flex-1",children:"Deeply Resonated ðŸŒŸ"}),e.jsx(f,{onClick:()=>y("somewhat_relevant"),variant:"outline",className:"border-gray-500 text-gray-300 hover:bg-gray-700/20 flex-1",children:"Somewhat Relevant ðŸŒ™"}),e.jsx(f,{onClick:()=>y("not_really"),variant:"outline",className:"border-gray-600 text-gray-400 hover:bg-gray-800/30 flex-1",children:"Not Really ðŸ”®"})]}),e.jsx("p",{className:"mt-4 text-xs text-gray-400 italic",children:"Your insights shape a deeper connection for your next reading. âœ¨"})]}),r&&t&&e.jsx("div",{className:"mt-8",children:e.jsx(f,{variant:"outline",onClick:$,className:"border-gold/50 text-gold",children:"View Full Details"})})]})},"simple")})};export{_ as A,Z as D};
